<fieldset id="available_components">
  <legend><%= t('.select_component') %></legend>

  <%= form_tag new_site_component_path, :method => :get do %>
    <div id="main">
      <select id="component_select" name="component" size="11">
        <% available_components_sorted.each do |component| %>
          <option value="<%= component[:name] %>">
            <%= component[:i18n] %>
          </option>
        <% end %>
      </select>

      <img id="component_image" src="/assets/components/default.png">
    </div>

    <button id="next_step">Pr√≥xima etapa</button>

  <% end %>
</fieldset>

<style type="text/css">
  fieldset#available_components select#component_select {
    height: 200px;
    width: 250px;
  }

  fieldset#available_components img#component_image {
    height: 180px;
    width: 230px;
    margin: 8px;
    border: 1px solid #888;
  }

  fieldset#available_components #next_step {
    margin-top: 8px;
  }

  fieldset#available_components #main {
    position: relative;
  }
</style>

<%= content_for :javascripts do %>
  <script type="text/javascript">
    $(window).ready(function() {
      var img_cache = {};
      var default_image = $('#component_image').attr('src');

      $('#component_select').change(function() {
        var selected = $('#component_select :selected').val();
        if (img_cache) {
          $('#component_image').attr('src', default_image);
          return;
        }

        var url = '/assets/components/' + selected + '.png';
        $.get(url, function() {
          $('#component_image').attr('src', url);
          img_cache[selected] = url;
        }).error(function(){
          $('#component_image').attr('src', default_image);
        });
      });
    });
  </script>
<% end %>