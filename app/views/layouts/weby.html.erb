<!DOCTYPE html>

<html lang=<%= session[:locale].to_s %> >
  <head>
    <title>Weby</title>
    <meta charset="utf-8">
    <%= csrf_meta_tag %>
    <%= stylesheet_link_tag 'institutional' %>
    <%= stylesheet_link_tag 'scaffold' %>
    <%= stylesheet_link_tag 'application' %>
    <%= stylesheet_link_tag 'semantic_forms' %>
    <%= stylesheet_link_tag 'weby' %>
    <%= stylesheet_link_tag 'paginate' %>
    <%= stylesheet_link_tag 'nivo-slider' %>
    <%= render :partial => 'sites/viewCsses' %>
    <!--[if lt IE 9]>
    <%= javascript_include_tag "http://html5shiv.googlecode.com/svn/trunk/html5.js" %>
    <%= javascript_include_tag "http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js" %>
    <![endif]-->
    <%= stylesheet_link_tag 'weby_negativo' if session[:contrast] == 'yes' %>
  </head>

  <body>
    <%= raw institutional_bar %>
    <div id="wrapper" <%= "style='width: #{ @main_width }px'" if @main_width %>>

      <header>
      <%= raw menu_admin(@site) %>
      <%= render :partial => "sites/viewCover" %>
      <nav>
      <%= raw print_menu(@menus['superior']) %>
      <nav class="right">
      <%= raw menu_acessibility %>
      <%= raw menu_locale %>
      </nav>
      </nav>        
      <div class="clear"> </div>   
      </header>

      <!-- MENUS RIGHT -->
      <!--aside class="right" >
      <nav>
      <%= raw print_menu(@menus['direita']) %>
      </nav>  
      </aside-->

      <!-- BANNERS RIGHT -->
      <!--aside id="banners_right">
      <div>
        <% @banners = @site.banners[0..3] %>
        <% @banners.each do |b| %>
          <figure>
            <%= image_tag(b.repository.archive.url(b.size), :height => '60', :alt => b.text) %>
          </figure>
        <% end %>
      </div>
      <div class="clear"></div>
      </aside-->

      <!-- TESTE PARA COMPONENTES -->
      <%= load_components 'right' %>

      <section id="content">
        <%= raw flash_message %>
        <% if controller.controller_name.include? 'pages' and controller.action_name.include? 'view' %>
          <!-- slider com imagens na lateral -->
          <div id="slider">
            <% images = @site.pages.category('slider')[0..3] %>
            <% images.each do |image| %>
              <%= image_tag image.repository.archive.url() %>
            <% end %>
          </div>
          <section id="pages">
          <ul>
            <% @front_news.each do |page| %>
              <li id=<%= "page_#{page.id}" %> style="list-style-type:none;">
              <article class="<%= cycle 'pageleft','pageright' %>">
                <% unless page.repository.nil? %>
                  <% page.repository.archive.reprocess! if File.file?(page.repository.archive.path) and
                    not File.file?(page.repository.archive.path(:little)) %>

                  <%= link_to image_tag("#{page.repository.archive.url(:mini)}",
                                        :alt => page.repository.description),
                                        site_page_path(@site, page, :type => params[:type]),
                                        :title => page.repository.description %>
                                    <% end %>

              <header>
                <h2> <%= link_to page.title, site_page_path(@site, page) %> </h2>
                <% if @site.view_desc_pages %>
                  <p><i>
                    <%= page.user.first_name ?
                      ("#{page.user.first_name} #{page.user.last_name}") :
                      page.user.login %>
                    <%= l page.created_at, :format => :short  %>
                  </i></p>
                <% end %>
              </header>
              <summary>
                <%= raw page.summary %>
              </summary>
              <p> <%= link_to t("read_more"), site_page_path(@site, page) %> </p>
              <div class="clear"></div>
              <%= raw make_menu(page) %>
            </article>
            </li>
            <% end %>
          </ul>
          <div class="clear"></div>
          <%#= paginate @front_news, :param_name => 'front_pages', :them => 'blog', :remote => true %>
        <% else %>
          <%= yield %>    
        <% end %>
      </section>
    </div>  

    <!--section id="banners_footer">
      <div>
        <% @banners = @site.banners[0..3] %>
        <% @banners.each do |b| %>
          <figure>
            <%= image_tag(b.repository.archive.url(b.size), :width => b.width, :height => b.height, :alt => b.text) %>
          </figure>
        <% end %>
      </div>
      <div class="clear"></div>
    </section-->
    <%= load_components 'bottom' %>

    <footer>
      <section id="footer">
        <div id="content-footer"></div>
        <%= raw @site.footer %>
      </section>
    </footer>

    <%= javascript_include_tag :defaults %>
    <%= javascript_include_tag "tiny_mce/jquery.tinymce" %>
    <%= javascript_include_tag "jquery-ui.min.js" %>
    <%= javascript_include_tag "jquery.nivo.slider.pack.js" %>
    <%= javascript_tag do %>
      $().ready(function() {
        $('#slider').nivoSlider({
          controlNav:false,
          directionNavHide:false,
          keyboardNav:false,
          prevText: 'Anterior',
          nextText: 'Pr√≥ximo'
        });

        $('textarea.mceAdvance').tinymce({
          script_url : '/javascripts/tiny_mce/tiny_mce.js',
          editor_selector : "mceAdvance",
          mode : "textareas",
          theme : "advanced",
          browsers : ["msie", "gecko", "safari"],
          convert_fonts_to_spans : true,
          theme_advanced_resizing : true,
          theme_advanced_toolbar_location : "top",
          theme_advanced_statusbar_location : "bottom",
          plugins : "inlinepopups,safari,curblyadvimage,paste,table,advlink",
          theme_advanced_buttons1 : "bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,fontselect,fontsizeselect",
          theme_advanced_buttons2 : "forecolor,backcolor,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup",
          theme_advanced_buttons3 : "tablecontrols,|,removeformat,charmap,help,code",
          plugin_preview_pageurl : "<%= @site.name.to_s if @site %>",
          relative_urls : false
        });

        $('textarea.mceSimple').tinymce({
          script_url : '/javascripts/tiny_mce/tiny_mce.js',
          editor_selector : "mceSimple",
          mode : "textareas",
          theme : "advanced",
          browsers : ["msie", "gecko", "safari"],
          theme_advanced_resizing : true,
          theme_advanced_toolbar_location : "top",
          theme_advanced_statusbar_location : "bottom",
          theme_advanced_buttons1 : "bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,|,link,unlink,|,removeformat,cleanup,help,|,pasteword,code",
          theme_advanced_buttons2 : "",
          theme_advanced_buttons3 : "",
          relative_urls : false
        });
      });
    <% end %>

  </body>

</html>  
