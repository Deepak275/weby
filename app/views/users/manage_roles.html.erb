<h1>Gerenciar papeis</h1>

<% # TODO separar entre visualização global e por site %>
<table class="list">

  <thead>
    <tr>
      <th>Usuário</th>
      <th>Papel</th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @site.users.uniq.each do |user| %>
      <tr class="<%= cycle 'odd', 'even' %>">
        <td><%= user.login %></td>

        <td>
          <span id="user-<%= user.id %>">
            <%= user.roles.map(&:name).join(', ') %>
          </span>
          
          <form id="form-user-<%= user.id %>" style="display: block;">
            <p>
              <% @roles.each do |role| %>
                <label>
                  <%= check_box_tag 'user[role_ids][]', role.id, user.roles.include?(role) %>
                  <%= role.name %>
                </label>
                <br />
              <% end %>
            </p>
          </form>
        </td>

        <td></td>
      </tr>
    <% end %>
  </tbody>

</table>

<h2>Todos os Usuarios</h2>

<%= form_tag change_roles_site_users_path(@site), :method => "post", :id => "subscribe_users" %>

  <div id="_left">
    <% (@users - @site.users).each do |user| %>
      <label>
        <%= check_box_tag 'user[id]', user.id %>
        <%= user.login %>
      </label><br/>
    <% end %>
  </div>


  <div id="_right">
    <% @roles.each do |role| %>
      <label>
        <%= check_box_tag 'user[role_ids][]', role.id %>
        <%= role.name %>
      </label>
      <br />
    <% end %>
  </div>

  <div id="_submit">
    <input type="submit" value="cadastrar" />
  </div>
</form>

