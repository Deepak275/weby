<script>
  $(function() {
    // TODO métodos para realizar a páginação manualmente
    $(".pages_paginator a[data-remote=true]").live("click", function() {
      $('table.list').html("<img src='/images/spinner.gif'>");
      $.get(this.href, {'tiny_mce': true }, null, 'script');
      return false;
    });
    $("table.list > thead > tr > th > a").live("click", function() {
      $('table.list').html("<img src='/images/spinner.gif'>");
      $.get(this.href, {'tiny_mce': true }, null, "script");
      return false;
    });
    
    // Forma um link para a página da forma:
    //  /sites/site_name/pages/page_id
    $("table.list > tbody > tr").live("click", function(){
      var page = tinyMCEPopup.editor.settings.plugin_preview_pageurl;
      $('#href').val("/sites/"+page+"/pages/"+$(this).find('td').first().text());
    });
    
    // Para realizar a consulta por páginas
    $('#search_button').live('click', function(e) {
      var search = $('#search').val();
      $.get(this.href, {'tiny_mce': true, 'search': search}, null, 'script');
      e.preventDefault();
      return false;
    });
  });
</script>
<style>
  table.list tr{
    cursor: pointer;
  }
  table.list tbody tr:hover {
    background: rgb(204, 204, 204);
  }
</style>
<div id="tinyMCE_search_area">
  <%= text_field_tag 'search', params[:search], :placeholder => t('search') + " " + t('page.other') %>
  <%= link_to t('search'), site_pages_path, :remote => true, :id => 'search_button' %>
</div>
<br/>

<table class='list' style="width:100%" rules="all" >
  <thead>
    <th><%= sortable 'id' %></th>
    <th><%= sortable 'title', t("title") %></th>
    <th><%= sortable 'author_id', t("author") %></th>
  </thead>
  <tbody>
    <% @pages.each do |page| %>
      <tr>
        <td><%= page.id %></td>
        <td><%= page.by_locale(session[:locale]).title %></td>
        <td><%= page.user.first_name ? ("#{page.user.first_name} #{page.user.last_name}") : page.user.login %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<br style="clear:both;" />
<div style="float:right;margin-bottom:10px;">
  <%# 
      FIXME Remote true não está funcionando aqui,
      ajax está sendo realizado por javascript manual
    %>
  <%= paginate @pages, :remote => true %>
</div>
