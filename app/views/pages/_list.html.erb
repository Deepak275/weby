  <% unless @pages.empty? %>
    <%= will_paginate @pages, :previous_label => t("will_paginate.previous"), :next_label => t("will_paginate.next"), :class => 'pagination ajax' %>
    <table id='pages-list' class='list'>
      <thead>
        <th><%= "id" %></th>
        <th><%= t"date_param", :param => t("register")%></th>
        <th><%= t"date_param", :param => t("publication")%></th>
        <th><%= t"title" %></th>
        <th><%= t"author" %></th>
        <th><%= t"type" %></th>
        <th><%= t"cover" %></th>
        <th><%= t"publish" %></th>
        <th></th>
      </thead>
      <tbody>
      <% @pages.each do |page| %>
        <tr class="<%= cycle 'odd', 'even' %>" id="<%= "page_#{page.id}" %>">
          <td><%= page.id %></td>
          <td><%= l page.created_at, :format => :short %></td>
          <td><%= l page.date_begin_at, :format => :short %></td>
          <td><%= page.title %></td>
          <td><%= page.user.login %></td>
          <td><%= t"#{page.type.downcase}.one" %></td>
          <td align="center"><%= raw toggle_field(page, "front") %></td>
          <td align="center"><%= raw toggle_field(page, "publish") %></td>
          <td>
            <%= raw make_menu(page) %> 
            <div class='handle icon icon-drag'><%= t("move") %></div>
          </td>
        </tr>
      <% end; reset_cycle %>
      </tbody>
    </table>
    <%= will_paginate @pages, :previous_label => t("will_paginate.previous"), :next_label => t("will_paginate.next"), :class => 'pagination ajax' %>
  <% else %>
    <% flash.now[:warning] = (t"none_param", :param => t("page.one")) %>
  <% end %>

  <%= javascript_tag do %>
    window.onload=function(){
      $().ready(function() {
        $('#pages-list').sortable({
          axis: 'y', 
          dropOnEmpty:false, 
          handle: '.handle', 
          cursor: 'crosshair',
          items: 'tr',
          opacity: 0.4,
          scroll: true,
          update: function(){
            $.ajax({
              type: 'post', 
              data: $('#pages-list').sortable('serialize'),
              dataType: 'script', 
              complete: function(request){
                  $('#pages-list').effect('highlight');
                },
              url: '<%= sort_site_pages_path %>'
            })
          }
        })
      })
    }
  <% end %>
