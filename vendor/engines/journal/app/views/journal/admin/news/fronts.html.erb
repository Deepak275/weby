<% title ".news" %>
<% breadcrumb :news_fronts %>
<div class="row" style="margin-bottom: 15px">
  <div class="col-md-7">
    <%= select_tag "filter-category",
       options_for_select(current_site.news_sites.uniq_category_counts.map{|c| [c.name, c.name.parameterize] }),
      include_blank: false,
      class: 'form-control select2 input-xlarge',
      multiple: true %>
  </div>
  <div class="col-md-5">
    <div class="pull-right">
      <% with_permission(action: :new) do %>
        <%= link_to t(".new_news"),
          new_admin_news_path,
          class: "btn btn-success" %>
      <% end %>
      <% with_permission(action: :index) do %>
        <%= link_to t(".news"), admin_news_index_path, class: 'btn btn-default' %>
      <% end %>
      <% with_permission(action: [:recover, :purge]) do %>
        <%= link_to t("recycle_bin"), recycle_bin_admin_news_index_path, class: "btn btn-default" %>
      <% end %>
      <% with_permission(controller: Sites::Admin::ExtensionsController, action: [:edit]) do %>
        <%= link_to icon('cog'), edit_site_admin_extension_path(current_site.extensions.find_by(name: 'journal')), class: "btn btn-default", title: t('.settings') %>
      <% end %>
    </div>
  </div>
</div>

<% if @newslist.empty? %>
  <div class="alert alert-warning">
    <%= t(".none_cover") %>
  </div>
<% else %>

  <table  class="table table-striped nowrap" id="list" data-sort-url="<%= sort_admin_news_index_path %>">
    <thead>
      <th width="32%"><%= t(".title") %></th>
      <th width="12%"><%= t(".user") %></th>
      <th width="13%"><%= t(".category") %></th>
      <th width="13%"><%= t(".created_at") %></th>
      <% with_permission(action: :edit) do %>
        <th  width="5%"><%= t(".cover") %></th>
        <th  width="5%"><%= t(".status") %></th>
      <% end %>
        <th  width="5%" class="center"><%= t(".views") %></th>
        <th  width="8%"><%= t(".action") %></th>
    </thead>
    <tbody>
      <% @newslist.each do |news_site| %>
        <% if news_site.news %>
          <% news = news_site.news %>
          <% next if !news.site&.active? %>
            <tr id="sort_news_<%= news.id %>" class="sort_news <%= news_site.category_list.map{|categ| categ.parameterize }.join(' ') %>">
              <td>
                <% if news.site_id == current_site.id %>
                <%=   link_to news.title, edit_admin_news_path(news) %>
                <%    else %>
                <%=      icon('retweet') %>
                <%=      "  #{news.title}" %>
                <%    end %>
              </td>
              <td><%= news.user.first_name %></td>
              <td><%= raw categories_links(news_site.category_list) %></td>
              <td><%= l(news.created_at, :format => :short) %></td>
              <% with_permission(action: :edit) do %>
                <td class="publish" style="text-align:center;">
                  <%= front_status(news_site) %></td>
                <td class="publish" style="text-align:center;">
                  <%= news_status(news) %></td>
              <% end %>
              <td style="text-align:center;"><%= news.view_count %></td>
              <td class="text-right">
                <%= make_menu(news, :except => "show", :with_text => false) %>
                <% with_permission(action: :sort) do %>
                  <%= link_to icon('trash'), unshare_admin_news_url(news), method: :put, data: { confirm: t('are_you_sure_unshare_item', item: news.title) } if news.site_id != current_site.id %>
                  <%= link_to icon('move'), '#', class: 'handle' %>
                <% end %>
              </td>
            </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
<% end %>

<% content_for :stylesheets, stylesheet_link_tag("sortable") %>
<% content_for :javascripts, javascript_include_tag("init/sortable") %>
<% content_for :javascripts, javascript_include_tag("journal/admin.news.fronts") %>
