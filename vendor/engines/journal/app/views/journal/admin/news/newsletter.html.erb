<% if(current_site.components.find_by(name: 'newsletter', publish: true)) %>
  <% breadcrumb :news_newsletter, @news %>
  <% component = Weby::Components.factory(current_site.components.find_by_name('newsletter')) %>
  <% @ids = Journal::Newsletter.by_site(current_site.id).ids.join(",") %>
  <% @emails = Journal::Newsletter.show_emails(current_site.id) %>
  <%= form_tag :newsletter_histories_admin_news, method: :post do %>
    <div class="form-group">
      <div class="row">
        <div class="col-md-2"><label for="from"><%= t('.from') %></label></div>
        <div class="col-md-6"><input type="text" name="from" class="form-control" value="<%= component.email %>"></div>
      </div>
      <div class="row">
        <div class="col-md-2"><label for="to"><%= t('.to') %></label></div>
        <div class="col-md-6">
          <textarea readonly name="to" class="form-control" rows="2"><%= @emails %></textarea>
        </div>
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#emailsModal">
          <%= t('.select_emails') %>
        </button>
        <input type="input" name="ids" value=<%= @ids %>>
      </div>
      <div class="row">
        <div class="col-md-2"><label for="subject"><%= t('.subject') %></label></div>
        <div class="col-md-10"><input type="text" name="subject" class="form-control" value="<%= component.subject=="1" ? @news.title : " " %>"></div>
      </div>
    </div>
    <br>
    <article class="news-show">
      <%= render 'show' %>
    </article>
    <% @histories = Journal::NewsletterHistories.sent(current_site.id, @news.id) %>
    <div class="form-action">
      <input type="submit" class="btn btn-primary" value=<%= t(".send") %> >
      <%= link_to t("back"), :back, class: "btn btn-default" %>
      <% if @histories.count > 0 %>
        <!-- Button history modal -->
        <button type="button" class="btn btn-success" data-toggle="modal" data-target="#historiesModal">
          <%= t('.history') %>
	    </button>
      <% end %>
      <%= render 'newsletter_emails' %>
      <%= render 'newsletter_histories' %>
    </div>
  <% end %>
<% end %>
